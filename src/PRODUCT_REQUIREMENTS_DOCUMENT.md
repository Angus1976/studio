

# AI 任务流平台产品需求文档 (PRD)

**版本**: 4.0
**日期**: 2025-08-25
**作者**: AI 任务流平台开发团队

---

## 1. 产品概述

### 1.1. 产品愿景

AI 任务流平台是一个连接 AI 数字员工能力的设计者、提供方与需求方的在线市场。它旨在通过使用全球主流大模型结合专业的提示词库、MCP、Agent、RPA、常用的第三方软件系统接口等，来构建一系列分类明确、标签清晰规范标准化的 AI 能力场景库和自动化的工作流，再通过我们的智能推荐引擎，准确快速的理解用户需求和意图，进而帮助企业和个人用户高效找到相关场景模板来解决特定业务问题，或者根据典型工作任务场景卡（模板）再次编辑微调后实现需求，微调过程可以基于模板DIY,也可以通过专业技术工程师在线交互支持并协助实现。同时为 AI 技术工程师提供一个展示、分享和商业化其专业能力的平台。

### 1.2. 核心价值

*   **对需求方 (用户)**: 提供一个智能引导式交互式平台，帮助用户清晰地表达业务需求，并快速匹配到经过验证的 AI 自动化解决方案（能力场景），降低使用 AI 的门槛和成本。用户可以是企业或个人。企业名下要有基本信息、组织架构、部门、岗位、主营业务、行业信息等，个人用户基本信息和补充信息，信息越丰富，AI构建用户画像越真实，对用户的意图和需求理解越准确。
*   **对供给方 (工程师)**: 提供一个强大的设计和测试环境，使其能够方便地将专业知识封装为可复用的 AI 能力场景，并通过平台触达潜在客户，实现知识变现。
*   **对平台方 (管理员)**: 提供一个可管理、可运营的市场平台，通过对租户、用户、交易和平台核心资产（如 LLM、软件许可）的有效管理，确保市场的健康、稳定和可持续发展。平台方能力包括：组织并集成全球主流大模型、通用提示词库（提供接口，让平台、工程师、用户可以方便的调相关提示词ID及简要说明）、账单计费、支持用户管理导入私有模型和KEY、用户个性提示词管理、MCP、Agent、RPA、常用的第三方软件系统接口等，平台方能力可灵活扩展，稳定运行。支持SaaS和Docker私有部署。

## 2. 用户角色与画像

本平台主要服务于以下四类核心角色：

| 角色组 | 角色名称 | 核心诉求 | 典型行为 |
| :--- | :--- | :--- | :--- |
| **平台方** | **管理员** | 监控平台整体运营状态，管理租户、用户及平台资产，确保市场秩序和交易安全。 | - 查看KPI数据<br>- 审批/管理租户和工程师账号<br>- 审核交易订单<br>- 配置平台级资产（LLM API等） |自动按相关策略批量和手动审批各类用户注册生效的的权限，平台层级所有的权限管理、分配。
| | **技术工程师** | 设计、开发和发布高质量的 AI 能力场景，通过平台将其交付给最终用户。 | - 在设计器中创建/编辑能力场景<br>- 使用测试工具调试Prompt<br>- 将成熟的场景发布到能力库 |在线支持|查询个人收益|
| **用户方** | **企业租户** | 为其组织寻找、采购和管理 AI 自动化解决方案，以提升业务效率。管理内部成员和资源。 | - 使用集采市场采购服务<br>- 管理内部成员账号和角色权限<br>- 查看Token使用情况和订单历史<br>- 管理企业API密钥 |设计导入企业相关的信息流|企业员工权限个性桌面配置：常用卡片部局 需求导航器 个人信息卡|
| | **个人用户** | 寻找并使用 AI 工具解决个人工作流中的特定问题，例如内容创作、代码辅助等。 | - 与AI需求导航器交互<br>- 浏览和试用推荐的能力场景<br>- 微调场景以满足个性化需求<br>- 联系工程师获取帮助 |个性桌面配置：常用卡片部局 需求导航器|个人信息卡|


## 3. 核心功能流程 (User Journey)

平台的核心用户流程是一个从需求探索到解决方案交付的完整闭环：

1.  **用户引导与需求探索**:
    *   新用户（个人用户或企业租户成员）访问平台主页，进入 `AI 需求导航器` 交互界面。
    *   AI 通过多轮引导式对话，收集用户的基本信息（如行业、角色、组织架构、员工或个人信息卡画像）和核心需求（希望解决的问题或自动化的任务）。
    *   系统根据对话内容，在后端实时构建一个临时的用户画像和意图分析。

2.  **智能路由与场景推荐**:
    *   当AI判断已收集足够信息后，需求分析完成。
    *   系统根据用户画像和意图，分析并确定一个最匹配的专家领域或智能体Agents（如“招聘”、“营销”），并将对应的需求与系统分析的结果“合成”后生成`promptId`传递给前端。
    *   前端根据这个`promptId`，从`能力场景库`中筛选并向用户直接展示一组高度相关的推荐场景卡片,场景卡片可以是一句提示词、一个MCP、一个第三方能力库、一个智能体、一个复杂的RPA流程等。场景卡是一个包罗万象的能力集合，平台方和工程师共同维护、更新场景卡。这个颗粒度可精可细。

3.  **场景交互与决策**:
    *   用户可以直接在主页上浏览推荐的场景列表。
    *   **直接选用**: 用户点击卡片上的“选用此场景”按钮。该场景的`promptId`会自动填充到右侧操作面板的“提示库连接器”中，用户可立即在下方的测试区域输入内容进行测试。
    *   **微调场景**: 用户点击“微调此场景”。场景的详细信息会加载到下方的`AI 场景架构师`视图中，用户可以编辑其标题、描述和核心提示词，并保存为自定义版本。

4.  **人工支持衔接**:
    *   如果在推荐列表中没有找到合适的场景，或者用户在微调时需要专业帮助。
    *   用户可以点击场景库下方的`联系工程师`按钮。
    *   系统会弹出一个包含平台方专家和认证第三方工程师列表的对话框，用户可以查看工程师信息并模拟发起联系。可以通过在线文本、语音、远程桌面等方式高效交互。

5.  **任务订单与交付**:
    *   当用户确认使用某个（标准或微调后的）场景后，可以在右侧操作面板点击`确认并生成任务订单`。
    *   系统会弹出一个包含任务摘要的确认对话框。
    *   用户确认后，模拟生成任务订单，并可以通过第三方支付链接完成定金或全款的支付。支持充值即送试用金等多种方式获得免费试用额度。支持互联转介绍裂变等商业模式。

## 4. 功能模块规格

### 4.1. 登录与注册 (`/login`, `/signup`)
*   **技术实现**: React 前端页面，使用 `useState` 和 `useRouter` 进行状态和路由管理。
*   **核心逻辑**:
    *   为平台方和用户方提供视觉上分离的登录/注册入口。
    *   按角色（企业租户、工程师、个人用户）提供独立的注册路径，而非统一的表单。
    *   表单使用 `react-hook-form` 和 `zod` 进行验证，确保邮箱、密码等格式正确。
    *   用户在注册/登录时选择明确的角色，平台方管理员角色由超级用户在后台创建，不支持公开注册。
    *   **本地化支持**: 明确支持中国区手机号注册/登录，并支持与主流短信验证平台（如阿里云）的API对接。
*   **用户界面**:
    *   页面中央是品牌Logo和标题。
    *   注册页面首先要求用户选择角色，然后进入该角色的专属注册表单。
    *   登录页面为管理员提供一个独立的入口（点击后提示由后台创建），为其他用户提供统一的邮箱/密码登录表单。
    *   页面底部提供在登录和注册页之间的切换链接。

### 4.2. AI 需求导航器 (主页核心组件)
*   **技术实现**:
    *   前端: `RequirementsNavigator` React 组件。
    *   后端: `aiRequirementsNavigator` 后端流程 (`src/ai/flows/ai-requirements-navigator.ts`)。**已与后端 LLM API 完全打通**。
*   **核心逻辑**:
    *   **引导式对话**: (已实现) 后端流程被精心设计，通过真实的 LLM 调用，引导 AI 主动提问，逐步收集用户画像所需的四个关键信息：企业特征、用户角色、需求场景、核心需求等，并支持平台方人工手动不断调优设置。
    *   **上下文维持**: (已实现) 每次交互都将完整的对话历史传递给后端流程，确保 AI 能够理解上下文。可选记忆模式，以扩充、归纳总结上下文长度。
    *   **完成判断**: (已实现) 后端流程在接收到包含特定关键词（如“确认”）的用户输入后，进行总结，并将 `isFinished` 标志位设为 `true`。
    *   **智能路由**: (已实现) 完成后，后端流程根据分析的用户需求，将 `suggestedPromptId` 设置为最匹配的专家ID（如 `recruitment-expert`）。此过程支持平台方管理员通过界面不断调参调优。
*   **用户界面**:
    *   左侧卡片式布局，包含标题“AI 需求导航器”。支持各卡片大小调节，并“记住”最近一次设置。
    *   对话区域使用 `ScrollArea`，自动滚动到底部。
    *   AI 和用户的消息使用不同颜色和对齐方式区分，并带有头像。
    *   AI 思考时，显示加载动画。
    *   对话结束后，输入框被禁用，并显示“需求分析完成”的提示。

### 4.3. 能力场景库与市场 (主页核心组件)
*   **技术实现**:
    *   工程师端: `PromptUniverseWorkbench` 组件 (`src/components/app/prompt-universe-workbench.tsx`)。
    *   用户端: `ScenarioLibraryViewer` 组件 (`src/components/app/scenario-library-viewer.tsx`)。
*   **核心逻辑**:
    *   **场景定义**: 一个能力场景在代码中被定义为一个包含`id`, `title`, `description`, `industry`, `task`, `prompt`的对象。以及其他可灵活支持大小不同场景卡的MCP,RPA,第三方系统接口等自定义对象。
    *   **工程师视图 (Workbench)**:
        *   采用三栏式布局，左侧为场景库，中间为结构化编辑器，右侧为测试与分析工具。
        *   所有操作均与后端数据库真实交互，实现提示词资产的持久化管理。
        *   支持各卡片大小调节，并“记住”最近一次设置。
    *   **用户视图 (Library Viewer)**:
        *   在用户主页，当需求导航完成后，此视图自动出现并展示推荐的场景列表。
        *   每个卡片提供“选用此场景”和“微调此场景”两个操作按钮。
        *   若无合适场景，或在列表底部，提供“联系工程师”入口。
         *   支持各卡片大小调节，并“记住”最近一次设置。

### 4.4. AI 场景架构师 (主页核心组件)
*   **技术实现**: `ScenarioArchitectView` 组件 (`src/components/app/scenario-architect-view.tsx`)。
*   **核心逻辑**:
    *   这是一个可编辑的表单视图。
    *   当用户在 `ScenarioLibraryViewer` 中点击“微调此场景”时，此视图被激活并显示。
    *   它会加载所选场景的现有数据（标题、描述、核心提示词）。
    *   用户可在此修改场景的各个字段。
    *   提供“保存自定义”按钮，用于将用户的修改作为一个新的、专属的场景**真实保存到数据库**。
     *   支持各卡片大小调节，并“记住”最近一次设置。
*   **用户界面**:
    *   卡片式布局，包含标题“AI 场景架构师”。
    *   包含“优化场景”（对应标题和描述）和“改进建议”（对应核心提示词）两个可编辑的 `Textarea`。
     *   支持各卡片大小调节，并“记住”最近一次设置。

### 4.5. 数字员工与提示词测试
*   **技术实现**: `digitalEmployee` 后端流程 (`src/ai/flows/digital-employee.ts`)，**已与后端 LLM API 完全打通**。
*   **核心逻辑**:
    *   这是一个通用的后端流程，它接收一个 `promptId` 和 `userContext`（测试内容）以及 `modelId` 作为输入。
    *   它首先使用 `promptLibraryConnector` 流程根据 `promptId` 从模拟的库中获取对应的提示词内容。
    *   然后，它动态地创建一个 Prompt，将获取到的提示词内容和用户提供的 `userContext` 组合起来，**调用用户选定的、在数据库中配置的大语言模型**并返回结果。
    *   支持直接传入 `promptContent`，用于测试尚未保存到库中的新提示词。
     *   支持各卡片大小调节，并“记住”最近一次设置。
*   **测试界面**:
    *   在工程师的`Workbench`视图和用户的操作面板中均提供测试区域。
    *   用户可以输入具体的业务内容来测试所选或所设计场景的实际效果。

### 4.6. 管理员仪表盘 (`/` for admin role)
*   **技术实现**: `AdminDashboard` 组件 (`src/components/app/admin-dashboard.tsx`)，**已与后端 Firestore 数据库完全打通**。
*   **核心逻辑**:
    *   **多租户管理**: 通过对话框提供对企业租户账户的增删改查功能。所有操作都通过真实的后端流程 (`admin-management-flows.ts`) 与数据库交互，实现持久化存储。
    *   **用户管理**: 类似地，管理平台上的所有个人用户和技术工程师账户，数据真实有效。
    *   **交易管理**: 在对话框中展示所有订单流水，并通过 `getAllOrders` 流程从数据库加载真实数据，并提供审核和更新订单状态的功能。
    *   **资产与权限管理**:
        *   在一个标签式对话框中，分别管理对接的 LLM 模型、集采商品、分配给租户的 Token 用量，以及其他软件资产（如 RPA 许可）。
        *   提供完整的增删改查功能，**所有配置均真实写入数据库**。支持将 LLM 模型配置为“通用”或“租户专属”。

*   **用户界面**:
    *   顶部为KPI卡片，展示总收入、活跃租户等核心数据。
    *   主体为2x2的管理面板网格，每个面板包含一个功能模块（租户管理、用户管理等）的入口按钮。
    *   右侧为“最近用户活动”列表，**根据用户真实注册时间排序**。

### 4.7. 企业租户仪表盘 (`/` for tenant role)
*   **技术实现**: `TenantDashboard` 组件 (`src/components/app/tenant-dashboard.tsx`)，**已与后端 Firestore 数据库完全打通**。
*   **核心逻辑**:
    *   **概览**: 展示核心数据，包括**由后端聚合订单数据生成的真实 Token 使用量图表**，并提供客户成功经理的联系方式和在线沟通入口。
    *   **集采市场**: 以卡片形式展示**由管理员动态维护的**所有可采购的标准化商品（软件、服务、AI资源），用户可点击“加入预购单”发起采购。
    *   **我的订单**: 以表格形式展示企业的所有采购订单及其状态，并提供“在线支付”等操作。
    *   **成员管理**: 管理企业内部的成员账户，包括邀请新成员、编辑成员角色、批量导入和导出列表。
    *   **资源与权限**:
        *   提供**已完成技术实现的 API 密钥管理功能**，允许企业租户安全地自助创建、查看和撤销 API 密钥。
        *   明确告知用户，平台已准备好对接全球主流大模型（包含中国的阿里、腾讯、DEEPSEEK等），租户只需添加自己的有效 API KEY 即可在平台上使用自己的模型资源。
        *   提供配置企业内部角色和权限体系的入口，支持自定义角色和权限。

*   **用户界面**:
    *   顶部为标签页导航，切换不同功能区。
    *   每个功能区都使用卡片和表格进行清晰、结构化的布局。
    *   所有“添加”、“编辑”等复杂操作均在弹出的对话框中完成，保持主界面的整洁。

### 4.8. AI智能工作台与任务调度
*   **技术实现**:
    *   前端: `TaskDispatchCenter` React 组件, 用于展示和确认AI规划的任务。
    *   后端: `taskDispatch` 后端流程 (`src/ai/flows/task-dispatch-flow.ts`)。**已与后端 LLM API 完全打通**。
*   **核心逻辑**:
    *   **从“提醒”到“执行”的进化**: 该功能不再仅仅是创建待办事项。它是一个智能工作台，AI不仅会思考，更能自主执行任务。
    *   **深度语义理解**: (已实现) 当用户提出具体执行的需求时（例如：“帮我分析Q3销售数据并给销售团队前三名发一封祝贺邮件”），平台首先进行深度语义理解。
    *   **任务分解与定性**: (已实现) AI判断这是一个复合任务（数据分析 + 邮件撰写 + 邮件发送）还是单一任务。
    *   **智能Agent匹配与调度**:
        *   (已实现) 平台会综合考虑任务的数据类型（例如，需要访问CRM系统）、输出要求（生成报告、发送邮件）、时效性等因素，为每个子任务匹配最优的Agent（AI数字员工）。
        *   在上述例子中，AI可能调度“数据分析Agent”连接数据库或CRM，然后调度“文案撰写Agent”生成祝贺邮件，最后由“邮件发送Agent”执行发送。
        *   支持同时调度多个Agent协同执行任务。
    *   **一键确认与执行**: AI会将分解后的任务计划呈现给用户（例如：“好的，我将首先分析销售数据，然后为XX、YY、ZZ起草祝贺邮件，您确认后立即发送。”）。用户只需一键确认，平台即开始执行整个工作流。
    *   **任务卡类型**: 任务调度中心支持两种类型的任务卡：
        *   **常驻任务卡**：由用户选用或调优后，决定长期保留在其工作台中的核心任务，方便随时调用。
        *   **单次任务卡**：为解决不常用或一次性问题而设计、选用的任务，执行后即归档，不会常驻在主工作台中。
        *   无论是常驻还是单次任务，其来源既可以是直接选用能力场景库中的标准化模板，也可以是用户根据自身特定需求自行编排和创建的。
    *   **实时监控与异常处理**:
        *   Agent任务的执行过程和结果由调度平台实时监控。
        *   如果遇到异常（例如，数据接口超时），系统会自动切换备选方案（例如，尝试另一个数据源或通知用户需要人工干预），确保任务流程的健壮性。
*   **用户界面**:
    *   左侧面板演变为“任务中心”，展示待确认的任务计划、正在执行的任务和已完成的任务历史。
    *   用户在主对话区通过自然语言下达指令。
    *   AI返回的不再是简单的文本回复，而是结构化的、可交互的任务计划卡片。用户可以在卡片上直接点击“确认执行”。

---
## 5. 非功能性需求

*   **UI/UX**:
    *   **风格**: 界面应简洁、现代、响应式，并提供清晰的操作指引。
    *   **组件库**: 基于 `shadcn/ui`，保证组件风格的统一和高质量。
    *   **色彩与字体**: 遵循项目初始设定的主色（淡蓝）、背景色（浅灰蓝）、强调色（紫）以及字体（Poppins, PT Sans）规范。
*   **性能**:
    *   AI 交互响应时间应尽可能短，页面加载速度快。
    *   在等待AI响应时，必须提供明确的加载状态（如加载动画），避免用户困惑。
*   **可扩展性**: 平台架构应支持方便地增加新的 AI 模型、能力场景和第三方服务。后端流程的设计已实现模块化，与具体 AI 引擎解耦，便于复用和扩展，并支持通过 API KEY 对接全球主流大模型。
*   **安全性**:
    *   用户的认证信息、API 密钥等敏感数据应被妥善处理。
    *   支付流程通过链接跳转至可信的第三方平台进行，平台本身不处理支付信息。
*   **代码质量**:
    *   遵循 React 和 Next.js 的最佳实践，如使用函数式组件和 Hooks。
    *   代码应清晰、可读、易于维护。
    *   所有后端流程都应使用 TypeScript 和 Zod 进行严格的类型定义和验证。

    
以上的项目中会用到大量的提示词，许多场景的设计都依赖大模型与专业的结构化提示配合。未来的许多项目也需要需要用到专业的结构化提示，因此，我们设计了一个相对独立的结构化提示工具，可以方便的进行提示词的管理，支持多语言，支持多模型，支持多版本，支持多租户，支持多角色，支持多场景，支持多任务，支持多任务流，支持多任务流版本，但是我不希望用户和企业直接看到平台方的提示词，可以看到提示词的简要介绍和相关ID，可能以通过API接口获取详细内容。希望这个模块相对独立，不仅支持此项目，同时可以支持其他项目调用此功能 。
如下是我们做的结构化提示工具原型，可以参考：

## 1. 概述 (Overview)

### 1.1. 项目愿景 (Vision)

“提示词宇宙” (Prompt Universe) 是一个面向企业和开发者的下一代、多租户 SaaS 平台，旨在提供一个集中化、结构化、可版本化和可追溯的提示词（Prompt）管理与优化解决方案。我们的目标是赋能团队高效协作，最大化大型语言模型（LLM）应用的性能、可靠性和成本效益，从而加速 AI 原生应用的开发和迭代周期。

### 1.2. 解决的问题 (Problem Statement)

随着 LLM 在企业中的广泛应用，团队面临着一系列严峻挑战：
- **提示词管理混乱**: 提示词散落在代码、文档和个人笔记中，难以复用、更新和追溯。
- **协作效率低下**: 团队成员无法有效共享、测试和迭代提示词，导致重复工作和质量不一。
- **成本与性能失控**: 缺乏对不同模型、不同提示词版本的成本和性能的精细化管理，导致资源浪费和效果不可预测。
- **安全与合规风险**: 关键的提示词资产和 API 密钥缺乏统一的安全管理和权限控制。
- **多租户管理复杂**: 为不同客户或业务部门提供隔离的、定制化的提示词服务时，管理成本高昂。

### 1.3. 目标用户 (Target Audience)

- **平台管理员 (Platform Admin)**: 负责整个 SaaS 平台的运营、租户管理、通用资源配置和结算。
- **租户管理员 (Tenant Admin)**: 负责管理其租户内的用户、专属 LLM 连接和提示词。
- **提示词工程师/开发者 (Prompt Engineer/Developer)**: 平台的核心用户，负责创建、测试、优化和发布提示词，并通过 API 在应用中调用。

---

## 2. 核心功能 (Core Features)

平台功能围绕三大支柱构建，确保为用户提供端到端的提示词生命周期管理体验。

### **支柱一：可视化与结构化的提示词工程**
> **用户故事**: 作为一个提示词工程师，我希望能在一个专业的环境中创建、测试和优化我的提示词，以便快速获得最佳的模型输出效果。

| 功能模块 | 用户故事/需求描述 | 验收标准 (Acceptance Criteria) |
| :--- | :--- | :--- |
| **结构化提示词编辑器** | - 我可以为提示词定义不同的组成部分，包括系统提示 (System)、用户指令 (User)、示例/上下文 (Context) 和反向提示 (Negative)。<br>- 我可以在用户指令中使用 `{{variable}}` 语法定义变量。 | - 编辑器提供四个独立的文本区域，分别对应四个组成部分。<br>- 带有 `{{}}` 的变量在编辑器中应有特殊高亮。 |
| **模型配置与测试** | - 我可以选择不同的 LLM 模型进行测试。<br>- 我可以实时调整 `temperature`, `top-p`, `max tokens` 等参数。<br>- 我可以动态添加、删除和编辑键值对，用于填充提示词中的变量。<br>- 我可以点击“生成”按钮，实时看到替换变量后和模型配置下的输出结果。 | - 提供模型选择下拉框。<br>- 提供参数调整的滑块 (Slider)。<br>- 提供一个动态列表，用于管理测试变量。<br>- “输出结果”区域能正确显示模型的返回内容。 |
| **AI 辅助元数据** | - 我可以一键触发 AI，自动为我的提示词生成元数据，如“适用范围”、“推荐模型”、“约束条件”和“适用场景”。 | - 点击“自动生成元数据”按钮后，AI 会分析提示词内容并填充对应的元数据字段。<br>- 生成过程有加载状态提示，完成后有成功通知。 |

### **支柱二：企业级的提示词资管与协作**
> **用户故事**: 作为一个团队的领导者，我希望能集中管理我们所有的提示词资产，确保其安全性、版本清晰，并方便团队成员协作。

| 功能模块 | 用户故事/需求描述 | 验收标准 (Acceptance Criteria) |
| :--- | :--- | :--- |
| **提示词库** | - 我可以在一个统一的列表中看到所有我能访问的提示词。<br>- 我可以根据 ID、名称、范围或标签进行搜索和筛选。<br>- 我可以清楚地看到每个提示词的范围（通用/专属）和关联的租户 ID。 | - `/dashboard/prompts` 页面使用表格 (Table) 展示提示词。<br>- 提供搜索框用于快速过滤。<br>- “适用范围”列使用徽章 (Badge) 进行视觉区分。 |
| **访问控制** | - 平台管理员可以创建“通用提示词”，所有租户可见。<br>- 租户管理员或提示词工程师可以创建“专属提示词”，仅自己租户可见。<br>- 在创建提示词时，我可以选择其适用范围。 | - 保存提示词时，提供“保存为通用”和“保存为专属”两个选项。<br>- 选择“专属”时，需要输入或确认租户 ID。<br>- 列表中仅显示用户有权访问的提示词。 |
| **动态合并 (V2)** | - 我可以在我的提示词中通过 ID 引用一个或多个平台通用提示词，以实现动态组合和复用。 | - 在创建提示词页面，提供一个“合并平台提示词”的输入框。<br>- 运行时，后端能正确解析 ID 并将对应提示词内容合并执行。 |

### **支柱三：多租户与平台运营**
> **用户故事**: 作为一个平台管理员，我需要高效地管理所有租户、配置平台级资源，并处理结算事宜，以确保平台顺利运营。

| 功能模块 | 用户故事/需求描述 | 验收标准 (Acceptance Criteria) |
| :--- | :--- | :--- |
| **多租户管理** | - 我可以查看所有租户的列表及其基本状态。<br>- 我可以手动添加新租户，并填写其公司名称、联系方式等信息。<br>- 我可以点击进入租户详情页，管理其特定信息和设置。 | - `/dashboard/tenants` 页面使用表格展示租户列表。<br>- “添加租户”按钮弹出一个表单，用于创建新租户。<br>- 点击租户行可以导航到 `/dashboard/tenants/[id]` 详情页。 |
| **LLM 连接管理** | - 我可以为平台添加“通用”的 LLM API Key，供所有租户使用。<br>- 我可以为特定租户添加“专属”的 LLM API Key。<br>- 租户可以通过安全的 API 接口导入其自己的专属密钥。 | - `/dashboard/llm` 页面展示所有 LLM 连接。<br>- “添加新模型”弹窗中可以选择连接属性（通用/专属）。<br>- 选择“专属”时，需关联租户 ID。UI 提示支持 API 导入。 |
| **结算与发票** | - 我可以查看平台的总账户余额，并进行充值。<br>- 我可以查看每个租户在本月的令牌（Token）使用明细。<br>- 我可以查看和下载历史发票。 | - `/dashboard/billing` 页面展示关键财务指标卡片。<br>- “充值”按钮提供支付宝、微信、银行转账等多种支付方式。<br>- 提供租户用量明细和历史发票的表格。 |
| **平台设置** | - 我可以修改平台的名称、Logo 和主题颜色。<br>- 我可以配置全局的安全策略，如会话超时时间。<br>- 我可以配置全局的 API 速率限制。 | - `/dashboard/settings` 页面使用标签页 (Tabs) 组织不同类别的设置。<br>- 外观设置（如颜色）可以实时预览和应用。 |

---

## 3. 非功能性需求 (Non-Functional Requirements)

| 类别 | 需求描述 |
| :--- | :--- |
| **性能 (Performance)** | - 页面加载时间（LCP）应在 2.5 秒以内。<br>- API 调用（如执行提示词）的 P95 延迟应在 2 秒以内（不含 LLM 生成时间）。 |
| **可扩展性 (Scalability)** | - 平台架构应能支持至少 1000 个并发租户。<br>- 提示词库应能高效处理百万级别的提示词存储和检索。 |
| **可用性 (Usability)** | - 界面设计应遵循提供的风格指南，简洁、直观，易于上手。<br>- 关键操作应有撤销或确认步骤，防止误操作。 |
| **安全性 (Security)** | - 所有敏感数据（如 API 密钥）在存储和传输过程中必须加密。<br>- 实施严格的访问控制，确保租户数据物理和逻辑隔离。<br>- 防止常见的 Web 漏洞，如 XSS, CSRF。 |
| **可访问性 (Accessibility)** | - UI 组件应遵循 WCAG 2.1 AA 标准，支持键盘导航和屏幕阅读器。 |

---

## 4. 技术栈 (Tech Stack)

- **前端**: Next.js (App Router), React, TypeScript
- **UI 库**: shadcn/ui, Tailwind CSS
- **AI/后端**: 全球所有的主流大模型，包含中国的大模型资源库中所配置可用的大模型，通过后端流程直接调用其原生 API。
- **数据库/认证**: Firebase (Firestore, Auth)
- **图标**: `lucide-react`
- **字体**: Poppins (标题), PT Sans (正文)

---

## 5. 未来规划 (Future Roadmap)

- **V1 (当前范围)**: 实现上述所有核心功能，提供一个功能完整的 MVP。
- **V2 (未来迭代)**:
  - **提示词版本控制**: 引入完整的版本历史记录和差异比较 (Diff) 功能。
  - **A/B 测试框架**: 允许用户针对不同提示词变体或模型配置进行 A/B 测试，并提供数据分析。
  - **团队协作增强**: 引入评论、审批工作流和更精细的角色权限管理。
  - **Firebase 集成**: 使用 Firestore 进行数据持久化，使用 Firebase Auth 进行用户认证。
  - **API 端点完善**: 提供完整的、面向租户的 `prompt-by-id` 调用 API，包含身份验证、用量跟踪和结算信息。

---

## 6. 成功指标 (Success Metrics)

- **用户活跃度 (DAU/MAU)**: 每日/每月活跃用户数。
- **功能采用率**: 各核心功能（如创建提示词、LLM 连接）的使用频率。
- **API 调用量**: 通过 API 执行提示词的总次数。
- **租户增长率**: 新注册租户的数量。
- **用户满意度 (CSAT/NPS)**: 通过问卷调查收集用户反馈。

---

