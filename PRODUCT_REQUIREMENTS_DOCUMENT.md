

# AI 任务流平台产品需求文档 (PRD)

**版本**: 3.0
**日期**: 2025-08-12
**作者**: AI 任务流平台开发团队

---

## 1. 产品概述

### 1.1. 产品愿景

AI 任务流平台是一个连接 AI 数字员工能力的设计者、提供方与需求方的在线市场。它旨在通过标准化的 AI 能力场景和自动化的工作流，帮助企业和个人用户高效解决特定业务问题，同时为 AI 技术工程师提供一个展示、分享和商业化其专业能力的平台。

### 1.2. 核心价值

*   **对需求方 (用户)**: 提供一个智能引导式平台，帮助用户清晰地表达业务需求，并快速匹配到经过验证的 AI 自动化解决方案（能力场景），降低使用 AI 的门槛和成本。
*   **对供给方 (工程师)**: 提供一个强大的设计和测试环境，使其能够方便地将专业知识封装为可复用的 AI 能力场景，并通过平台触达潜在客户，实现知识变现。
*   **对平台方 (管理员)**: 提供一个可管理、可运营的市场平台，通过对租户、用户、交易和平台核心资产（如 LLM、软件许可）的有效管理，确保市场的健康、稳定和可持续发展。

## 2. 用户角色与画像

本平台主要服务于以下四类核心角色：

| 角色组 | 角色名称 | 核心诉求 | 典型行为 |
| :--- | :--- | :--- | :--- |
| **平台方** | **管理员** | 监控平台整体运营状态，管理租户、用户及平台资产，确保市场秩序和交易安全。 | - 查看KPI数据<br>- 审批/管理租户和工程师账号<br>- 审核交易订单<br>- 配置平台级资产（LLM API等） |
| | **技术工程师** | 设计、开发和发布高质量的 AI 能力场景，通过平台将其交付给最终用户。 | - 在设计器中创建/编辑能力场景<br>- 使用测试工具调试Prompt<br>- 将成熟的场景发布到能力库 |
| **用户方** | **企业租户** | 为其组织寻找、采购和管理 AI 自动化解决方案，以提升业务效率。管理内部成员和资源。 | - 使用集采市场采购服务<br>- 管理内部成员账号和角色权限<br>- 查看Token使用情况和订单历史<br>- 管理企业API密钥 |
| | **个人用户** | 寻找并使用 AI 工具解决个人工作流中的特定问题，例如内容创作、代码辅助等。 | - 与AI需求导航器交互<br>- 浏览和试用推荐的能力场景<br>- 微调场景以满足个性化需求<br>- 联系工程师获取帮助 |


## 3. 核心功能流程 (User Journey)

平台的核心用户流程是一个从需求探索到解决方案交付的完整闭环：

1.  **用户引导与需求探索**:
    *   新用户（个人用户或企业租户成员）访问平台主页，进入 `AI 需求导航器` 交互界面。
    *   AI 通过多轮引导式对话，收集用户的基本信息（如行业、角色）和核心需求（希望解决的问题或自动化的任务）。
    *   系统根据对话内容，在后端实时构建一个临时的用户画像。

2.  **智能路由与场景推荐**:
    *   当AI判断已收集足够信息后，需求分析完成。
    *   系统根据用户画像和意图，分析并确定一个最匹配的专家领域（如“招聘”、“营销”），并将对应的`promptId`传递给前端。
    *   前端根据这个`promptId`，从`能力场景库`中筛选并向用户直接展示一组高度相关的推荐场景卡片。

3.  **场景交互与决策**:
    *   用户可以直接在主页上浏览推荐的场景列表。
    *   **直接选用**: 用户点击卡片上的“选用此场景”按钮。该场景的`promptId`会自动填充到右侧操作面板的“提示库连接器”中，用户可立即在下方的测试区域输入内容进行测试。
    *   **微调场景**: 用户点击“微调此场景”。场景的详细信息会加载到下方的`AI 场景架构师`视图中，用户可以编辑其标题、描述和核心提示词，并保存为自定义版本。

4.  **人工支持衔接**:
    *   如果在推荐列表中没有找到合适的场景，或者用户在微调时需要专业帮助。
    *   用户可以点击场景库下方的`联系工程师`按钮。
    *   系统会弹出一个包含平台方专家和认证第三方工程师列表的对话框，用户可以查看工程师信息并模拟发起联系。

5.  **任务订单与交付**:
    *   当用户确认使用某个（标准或微调后的）场景后，可以在右侧操作面板点击`确认并生成任务订单`。
    *   系统会弹出一个包含任务摘要的确认对话框。
    *   用户确认后，模拟生成任务订单，并可以通过第三方支付链接完成定金或全款的支付。

## 4. 功能模块规格

### 4.1. 登录与注册 (`/login`, `/signup`)
*   **技术实现**: React 前端页面，使用 `useState` 和 `useRouter` 进行状态和路由管理。
*   **核心逻辑**:
    *   提供统一的登录/注册入口。
    *   表单使用 `react-hook-form` 和 `zod` 进行验证，确保邮箱、密码和角色的格式正确。
    *   用户在注册/登录时需从四个角色（管理员、工程师、企业租户、个人用户）中选择一个。
    *   **演示模式**: 登录页提供“一键登录”功能，允许用户直接以任意角色身份进入平台，便于快速体验。
*   **用户界面**:
    *   页面中央是品牌Logo和标题。
    *   下方是“一键登录”区域，按“平台方”和“用户方”分组，每个角色一个带图标的按钮。
    *   再下方是传统的邮箱/密码/角色登录表单。
    *   页面底部提供切换到注册或登录页的链接。

### 4.2. AI 需求导航器 (主页核心组件)
*   **技术实现**:
    *   前端: `RequirementsNavigator` React 组件。
    *   后端: `aiRequirementsNavigator` Genkit Flow (`src/ai/flows/ai-requirements-navigator.ts`)，使用 `gemini-1.5-flash` 模型。
*   **核心逻辑**:
    *   **引导式对话**: Flow 的 Prompt 被精心设计，以引导 AI 主动提问，逐步收集用户画像所需的四个关键信息：企业特征、用户角色、需求场景、核心需求。
    *   **上下文维持**: 每次交互都将完整的对话历史传递给 Genkit Flow，确保 AI 能够理解上下文。
    *   **完成判断**: Prompt 指示 AI 在收集到所有信息后，进行总结，并询问用户确认。用户确认后，将 `isFinished` 标志位设为 `true`。
    *   **智能路由**: 完成后，AI 根据分析的用户需求，将 `suggestedPromptId` 设置为最匹配的专家ID（如 `recruitment-expert`）。
*   **用户界面**:
    *   左侧卡片式布局，包含标题“AI 需求导航器”。
    *   对话区域使用 `ScrollArea`，自动滚动到底部。
    *   AI 和用户的消息使用不同颜色和对齐方式区分，并带有头像。
    *   AI 思考时，显示加载动画。
    *   对话结束后，输入框被禁用，并显示“需求分析完成”的提示。

### 4.3. 能力场景库与市场 (主页核心组件)
*   **技术实现**:
    *   工程师端: `Designer` 组件 (`src/components/app/designer.tsx`)。
    *   用户端: `ScenarioLibraryViewer` 组件 (`src/components/app/scenario-library-viewer.tsx`)。
*   **核心逻辑**:
    *   **场景定义**: 一个能力场景在代码中被定义为一个包含`id`, `title`, `description`, `industry`, `task`, `prompt`的对象。
    *   **工程师视图 (Designer)**:
        *   左侧为场景库，以卡片形式展示所有场景，并提供编辑和删除功能。
        *   右侧为设计器，包含一个完整的表单，用于创建或编辑场景的各个字段。
        *   设计器下方提供“添加到场景库”按钮，用于保存新场景或更新现有场景。
        *   提供独立的测试区，可以测试新编写的Prompt，或调用已保存的Prompt ID进行测试。
    *   **用户视图 (Library Viewer)**:
        *   在用户主页，当需求导航完成后，此视图自动出现并展示推荐的场景列表。
        *   每个卡片提供“选用此场景”和“微调此场景”两个操作按钮。
        *   若无合适场景，或在列表底部，提供“联系工程师”入口。

### 4.4. AI 场景架构师 (主页核心组件)
*   **技术实现**: `ScenarioArchitectView` 组件 (`src/components/app/scenario-architect-view.tsx`)。
*   **核心逻辑**:
    *   这是一个可编辑的表单视图，默认隐藏。
    *   当用户在 `ScenarioLibraryViewer` 中点击“微调此场景”时，此视图被激活并显示。
    *   它会加载所选场景的现有数据（标题、描述、核心提示词）。
    *   用户可在此修改场景的各个字段。
    *   提供“保存自定义”按钮，用于模拟保存用户的修改。
*   **用户界面**:
    *   卡片式布局，包含标题“AI 场景架构师”。
    *   包含“优化场景”（对应标题和描述）和“改进建议”（对应核心提示词）两个可编辑的 `Textarea`。

### 4.5. 数字员工与提示词测试
*   **技术实现**: `digitalEmployee` Genkit Flow (`src/ai/flows/digital-employee.ts`)。
*   **核心逻辑**:
    *   这是一个通用的Genkit流程，它接收一个 `promptId` 和 `userContext`（测试内容）作为输入。
    *   它首先使用 `promptLibraryConnector` Flow 根据 `promptId` 从模拟的库中获取对应的提示词内容。
    *   然后，它动态地创建一个 Prompt，将获取到的提示词内容和用户提供的 `userContext` 组合起来，调用大语言模型并返回结果。
    *   支持直接传入 `promptContent`，用于测试尚未保存到库中的新提示词。
*   **测试界面**:
    *   在工程师的`Designer`视图和用户的操作面板中均提供测试区域。
    *   用户可以输入具体的业务内容来测试所选或所设计场景的实际效果。

### 4.6. 管理员仪表盘 (`/` for admin role)
*   **技术实现**: `AdminDashboard` 组件 (`src/components/app/admin-dashboard.tsx`)。
*   **核心逻辑**:
    *   **多租户管理**: 通过对话框提供对企业租户账户的增删改查功能。
    *   **用户管理**: 类似地，管理平台上的所有个人用户和技术工程师账户。
    *   **交易管理**: 在对话框中展示所有订单流水，并提供审核和更新订单状态的功能。
    *   **资产与权限管理**:
        *   在一个标签式对话框中，分别管理对接的 LLM 模型、分配给租户的 Token 用量，以及其他软件资产（如 RPA 许可）。
        *   提供完整的增删改查功能。
*   **用户界面**:
    *   顶部为KPI卡片，展示总收入、活跃租户等核心数据。
    *   主体为2x2的管理面板网格，每个面板包含一个功能模块（租户管理、用户管理等）的入口按钮。
    *   右侧为“最近用户活动”列表。

### 4.7. 企业租户仪表盘 (`/` for tenant role)
*   **技术实现**: `TenantDashboard` 组件 (`src/components/app/tenant-dashboard.tsx`)。
*   **核心逻辑**:
    *   **概览**: 展示核心数据（如Token使用量图表），并提供客户成功经理的联系方式和在线沟通入口。
    *   **集采市场**: 以卡片形式展示所有可采购的标准化商品（软件、服务、AI资源），用户可点击“加入预购单”发起采购。
    *   **我的订单**: 以表格形式展示企业的所有采购订单及其状态，并提供“在线支付”等操作。
    *   **成员管理**: 管理企业内部的成员账户，包括邀请新成员、编辑成员角色、批量导入和导出列表。
    *   **资源与权限**:
        *   提供管理企业自己账户的 API 密钥的入口。
        *   提供配置企业内部角色和权限体系的入口，支持自定义角色和权限。

*   **用户界面**:
    *   顶部为标签页导航，切换不同功能区。
    *   每个功能区都使用卡片和表格进行清晰、结构化的布局。
    *   所有“添加”、“编辑”等复杂操作均在弹出的对话框中完成，保持主界面的整洁。

### 4.8. AI智能工作台与任务调度
*   **技术实现**:
    *   前端: `TaskDispatchCenter` React 组件, 用于展示和确认AI规划的任务。
    *   后端: `taskDispatch` Genkit Flow, 一个高级的AI流程。
*   **核心逻辑**:
    *   **从“提醒”到“执行”的进化**: 该功能不再仅仅是创建待办事项。它是一个智能工作台，AI不仅会思考，更能自主执行任务。
    *   **深度语义理解**: 当用户提出具体执行的需求时（例如：“帮我分析Q3销售数据并给销售团队前三名发一封祝贺邮件”），平台首先进行深度语义理解。
    *   **任务分解与定性**: AI判断这是一个复合任务（数据分析 + 邮件撰写 + 邮件发送）还是单一任务。
    *   **智能Agent匹配与调度**:
        *   平台会综合考虑任务的数据类型（例如，需要访问CRM系统）、输出要求（生成报告、发送邮件）、时效性等因素，为每个子任务匹配最优的Agent（AI数字员工）。
        *   在上述例子中，AI可能调度“数据分析Agent”连接数据库或CRM，然后调度“文案撰写Agent”生成祝贺邮件，最后由“邮件发送Agent”执行发送。
        *   支持同时调度多个Agent协同执行任务。
    *   **一键确认与执行**: AI会将分解后的任务计划呈现给用户（例如：“好的，我将首先分析销售数据，然后为XX、YY、ZZ起草祝贺邮件，您确认后立即发送。”）。用户只需一键确认，平台即开始执行整个工作流。
    *   **任务卡类型**: 任务调度中心支持两种类型的任务卡：
        *   **常驻任务卡**：由用户选用或调优后，决定长期保留在其工作台中的核心任务，方便随时调用。
        *   **单次任务卡**：为解决不常用或一次性问题而设计、选用的任务，执行后即归档，不会常驻在主工作台中。
        *   无论是常驻还是单次任务，其来源既可以是直接选用能力场景库中的标准化模板，也可以是用户根据自身特定需求自行编排和创建的。
    *   **实时监控与异常处理**:
        *   Agent任务的执行过程和结果由调度平台实时监控。
        *   如果遇到异常（例如，数据接口超时），系统会自动切换备选方案（例如，尝试另一个数据源或通知用户需要人工干预），确保任务流程的健壮性。
*   **用户界面**:
    *   左侧面板演变为“任务中心”，展示待确认的任务计划、正在执行的任务和已完成的任务历史。
    *   用户在主对话区通过自然语言下达指令。
    *   AI返回的不再是简单的文本回复，而是结构化的、可交互的任务计划卡片。用户可以在卡片上直接点击“确认执行”。

---
## 5. 非功能性需求

*   **UI/UX**:
    *   **风格**: 界面应简洁、现代、响应式，并提供清晰的操作指引。
    *   **组件库**: 基于 `shadcn/ui`，保证组件风格的统一和高质量。
    *   **色彩与字体**: 遵循项目初始设定的主色（淡蓝）、背景色（浅灰蓝）、强调色（紫）以及字体（Space Grotesk, Inter）规范。
*   **性能**:
    *   AI 交互响应时间应尽可能短，页面加载速度快。
    *   在等待AI响应时，必须提供明确的加载状态（如加载动画），避免用户困惑。
*   **可扩展性**: 平台架构应支持未来方便地增加新的 AI 模型、能力场景和第三方服务。Genkit Flow 的设计应模块化，便于复用和扩展。
*   **安全性**:
    *   用户的认证信息、API 密钥等敏感数据应被妥善处理。
    *   支付流程通过链接跳转至可信的第三方平台进行，平台本身不处理支付信息。
*   **代码质量**:
    *   遵循 React 和 Next.js 的最佳实践，如使用函数式组件和 Hooks。
    *   代码应清晰、可读、易于维护。
    *   所有 AI 流程都应使用 TypeScript 和 Zod 进行严格的类型定义和验证。

    



